<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test /api/maths</title>
  </head>
  <body>
    <h1>Test du service /api/maths</h1>
    <fieldset>
      <legend>
        <h3>Url du service</h3>
      </legend>
      <input
        style="width: 20%"
        type="url"
        id="test-url"
        value="http://localhost:5000/api/maths"
      />
      <span>/api/maths</span>
      <button id="test-btn">Démarrer le test</button>
      <button id="help-btn">Aide</button>
    </fieldset>
    <fieldset>
      <legend>
        <h3>Tests</h3>
      </legend>

      <!-- Tests -->
      <div id="test-container" class="container"></div>
    </fieldset>
    <!-- Verdict -->
    <fieldset>
      <legend>
        <h3>Verdict</h3>
      </legend>

      <!-- Verdict -->
      <div id="verdict-container" class="container"></div>
    </fieldset>
    <br />
    <hr />
    <h5>Math-API | Nicolas Ricci & Benjamin Gerard</h5>
  </body>
</html>

<script>
  // Tableau des URLs à tester
  const urls = [
    "http://localhost:5000/api/maths?x=3&y=5&op=+",
    "http://localhost:5000/api/maths?x=10&y=-2&op=+",
    "http://localhost:5000/api/maths?x=5&y=a&op=+",
    "http://localhost:5000/api/maths?x=7&y=6&op=*",
    "http://localhost:5000/api/maths?x=8&y=0&op=*",
    "http://localhost:5000/api/maths?x=9&y=-3&op=*",
    "http://localhost:5000/api/maths?x=12&y=3x&op=*",
    "http://localhost:5000/api/maths?x=10&y=2&op=/",
    "http://localhost:5000/api/maths?x=9&y=3&op=/",
    "http://localhost:5000/api/maths?x=5&y=0&op=/",
    "http://localhost:5000/api/maths?x=15&y=b&op=/",
    "http://localhost:5000/api/maths?x=5&y=3&op=-",
    "http://localhost:5000/api/maths?x=20&y=7&op=-",
    "http://localhost:5000/api/maths?x=15&y=-4&op=-",
    "http://localhost:5000/api/maths?x=abc&y=2&op=-",
    "http://localhost:5000/api/maths?x=3&y=4&op=plus",
    "http://localhost:5000/api/maths?x=10&y=5&op=%",
    "http://localhost:5000/api/maths?x=7&y=&op=+",
    "http://localhost:5000/api/maths?x=&y=3&op=*",
  ];

  let errors = false;

  function afficherReponse(response, isError = false) {
    const container = document.getElementById("test-container");
    const div = document.createElement("div");

    if (isError) {
      div.innerHTML = `Erreur ---> { error: ${response.error} }`;
    } else {
      const op = response.op || "undefined";
      const x = response.x || "undefined";
      const y = response.y || "undefined";
      const value = response.value !== undefined ? response.value : "undefined";

      div.innerHTML = `OK ---> { op: ${op}, x: ${x}, y: ${y}, value: ${value} }`;
    }

    container.appendChild(div);
  }

  function testerUrls() {
    document.getElementById("test-container").innerHTML = "";
    document.getElementById("verdict-container").innerHTML = "";
    errors = false;

    let promises = urls.map((url) => {
      return fetch(url)
        .then((response) => response.json())
        .then((data) => {
          afficherReponse(data);
        })
        .catch((error) => {
          afficherReponse({ error: "Erreur lors de la requête" }, true);
          errors = true;
        });
    });

    Promise.all(promises).then(() => {
      const verdictContainer = document.getElementById("verdict-container");
      if (!errors) {
        verdictContainer.innerHTML = "<strong>Bravo! aucun problème</strong>";
      } else {
        verdictContainer.innerHTML =
          "<strong>Des erreurs ont été rencontrées.</strong>";
      }
    });
  }

  document.getElementById("test-btn").addEventListener("click", testerUrls);

  document.getElementById("help-btn").addEventListener("click", function () {
    window.location.href = "aide.html";
  });
</script>
